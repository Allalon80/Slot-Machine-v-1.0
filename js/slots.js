var slotMachine={stripHeight:720,alignmentOffset:86,firstReelStopTime:667,secondReelStopTime:575,thirdReelStopTime:568,payoutStopTime:700,reelSpeedDifference:0,reelSpeed1Delta:100,reelSpeed1Time:0,reelSpeed2Delta:100,positioningTime:200,bounceHeight:200,bounceTime:1e3,winningsFormatPrefix:"",spinURL:"/slots/spin.php",curBet:minBet,soundEnabled:!0,sounds:{},init:function(){$("#betSpinUp").click(function(){slotMachine.change_bet(1)}),$("#betSpinDown").click(function(){slotMachine.change_bet(-1)}),$("#spinButton").click(function(){slotMachine.spin()}),$("#soundOffButton").click(function(){slotMachine.toggle_sound()}),slotMachine.soundEnabled&&soundManager.setup({url:"/js/",onready:function(){slotMachine.sounds.payout=soundManager.createSound({id:"payout",url:"sounds/payout.mp3"}),slotMachine.sounds.fastpayout=soundManager.createSound({id:"fastpayout",url:"sounds/fastpayout.mp3"}),slotMachine.sounds.spinning=soundManager.createSound({id:"spinning",url:"sounds/spinning.mp3"})}})},change_bet:function(a){slotMachine.curBet+=a,slotMachine.curBet=Math.min(Math.max(minBet,slotMachine.curBet),maxBet),slotMachine.show_won_state(!1),$("#bet").html(slotMachine.curBet),$("#prizes_list .tdPayout").each(function(){var a=$(this);a.html((a.attr("data-payoutPrefix")||"")+parseInt(a.attr("data-basePayout"),10)*slotMachine.curBet+(a.attr("data-payoutSuffix")||""))})},toggle_sound:function(){$("#soundOffButton").hasClass("off")?soundManager.unmute():soundManager.mute(),$("#soundOffButton").toggleClass("off")},spin:function(){var a=parseInt($("#credits").html(),10);if($("#spinButton").hasClass("disabled"))return!1;slotMachine.show_won_state(!1),$("#spinButton").addClass("disabled"),$("#credits").html(a-slotMachine.curBet),slotMachine._start_reel_spin(1,0),slotMachine._start_reel_spin(2,slotMachine.secondReelStopTime),slotMachine._start_reel_spin(3,slotMachine.secondReelStopTime+slotMachine.thirdReelStopTime);try{slotMachine.sounds.spinning.play()}catch(a){}var b=function(){var a=0;window.setTimeout(function(){slotMachine._stop_reel_spin(1,d.reels[0])},a),a+=slotMachine.secondReelStopTime,window.setTimeout(function(){slotMachine._stop_reel_spin(2,d.reels[1])},a),a+=slotMachine.thirdReelStopTime,window.setTimeout(function(){slotMachine._stop_reel_spin(3,d.reels[2])},a),a+=slotMachine.payoutStopTime,window.setTimeout(function(){slotMachine.end_spin(d)},a)},c=!1,d=null;window.setTimeout(function(){c=!0,null!=d&&b()},slotMachine.firstReelStopTime),$.ajax({url:slotMachine.spinURL,type:"POST",data:{bet:slotMachine.curBet,windowID:windowID,machine_name:machineName},dataType:"json",timeout:1e4,success:function(a){return a.success?(d=a,void(1==c&&b())):(slotMachine.abort_spin_abruptly(),"loggedOut"==a.error?$("#loggedOutMessage").show():alert(a.error),!1)},error:function(){slotMachine.abort_spin_abruptly(),$("#failedRequestMessage").show()}})},show_won_state:function(a,b,c){a?(c?$("#PageContainer, #SlotsOuterContainer").addClass(c):$("#PageContainer, #SlotsOuterContainer").addClass("won"),$("#trPrize_"+b).addClass("won")):($(".trPrize").removeClass("won"),$("#PageContainer, #SlotsOuterContainer").removeClass(),$("#lastWin").html(""))},end_spin:function(a){null!=a.prize?(slotMachine.show_won_state(!0,a.prize.id,a.prize.winType),slotMachine._increment_payout_counter(a)):slotMachine._end_spin_after_payout(a)},_format_winnings_number:function(a){return a==Math.floor(a)?a:a.toFixed(2)},_end_spin_after_payout:function(a){"undefined"!=typeof a.credits&&$("#credits").html(a.credits),"undefined"!=typeof a.dayWinnings&&$("#dayWinnings").html(slotMachine.winningsFormatPrefix+slotMachine._format_winnings_number(a.dayWinnings)),"undefined"!=typeof a.lifetimeWinnings&&$("#lifetimeWinnings").html(slotMachine.winningsFormatPrefix+slotMachine._format_winnings_number(a.lifetimeWinnings)),"undefined"!=typeof a.lastWin&&$("#lastWin").html(a.lastWin);var b=parseInt($("#credits").html(),10);b>0&&$("#spinButton").removeClass("disabled")},_increment_payout_counter:function(a){var b={credits:a.credits-a.prize.payoutCredits,dayWinnings:a.dayWinnings-a.prize.payoutWinnings,lifetimeWinnings:a.lifetimeWinnings-a.prize.payoutWinnings},c=Math.max(a.credits-b.credits,a.dayWinnings-b.dayWinnings),d=c>80?"fastpayout":"payout",e=c>80?50:200;try{slotMachine.sounds[d].play({onfinish:function(){this.play()}})}catch(a){}var f=window.setInterval(function(){var c=!1;if($.each(["credits","dayWinnings","lifetimeWinnings"],function(d,e){b[e]<a[e]&&(b[e]+=1,b[e]=Math.min(b[e],a[e]),"credits"!=e?$("#"+e).html(slotMachine.winningsFormatPrefix+slotMachine._format_winnings_number(b[e])):$("#"+e).html(b[e]),c=!0)}),!c){window.clearInterval(f);try{slotMachine.sounds[d].stop()}catch(a){}slotMachine._end_spin_after_payout(a)}},e)},abort_spin_abruptly:function(){slotMachine._stop_reel_spin(1,null),slotMachine._stop_reel_spin(2,null),slotMachine._stop_reel_spin(3,null);try{slotMachine.sounds.spinning.stop()}catch(a){}},_start_reel_spin:function(a,b){var c=Date.now(),d=$("#reel"+a);d.css({top:-(Math.random()*slotMachine.stripHeight*2)});var e=parseInt(d.css("top"),10),f=function(){d.css({top:e}),e+=Date.now()<c+slotMachine.reelSpeed1Time+b?slotMachine.reelSpeed1Delta:slotMachine.reelSpeed2Delta,e+=a*slotMachine.reelSpeedDifference,e>0&&(e=2*-slotMachine.stripHeight)},g=window.setInterval(f,20);d.data("spinTimer",g)},_stop_reel_spin:function(a,b){var c=$("#reel"+a),d=c.data("spinTimer");if(window.clearInterval(d),c.data("spinTimer",null),null!=b){var e=slotMachine.stripHeight/window.numIconsPerReel,f=-slotMachine.stripHeight-(b-1)*e+slotMachine.alignmentOffset;c.css({top:f-slotMachine.stripHeight}).animate({top:f+slotMachine.bounceHeight},slotMachine.positioningTime,"linear",function(){c.animate({top:f},slotMachine.bounceTime,"easeOutElastic")})}}};slotMachine.init();